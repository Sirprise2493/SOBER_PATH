<!-- app/views/pages/_journal_book.html.erb -->

<% journal_content = local_assigns.fetch(:journal_content) %>

<div class="book-container">
  <!-- Left page: input or text -->
  <div class="book-page left">
    <% if journal_content&.persisted? %>
      <h2>Entry for <%= l(date) %></h2>
      <p><%= simple_format(journal_content.content) %></p>

    <% elsif date == today %>
      <h2>Entry for <%= l(date) %></h2>

      <%= form_with model: journal_content, url: journal_contents_path do |f| %>
        <% if journal_content&.errors&.any? %>
          <div class="errors">
            <h3><%= pluralize(journal_content.errors.count, "error") %>:</h3>
            <ul>
              <% journal_content.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="field">
          <%= f.label :content, "What's on your mind today?" %><br>
          <%= f.text_area :content, rows: 15 %>
        </div>

        <div class="actions">
          <%= f.submit "Save" %>
        </div>
      <% end %>

    <% else %>
      <h2>Entry for <%= l(date) %></h2>
      <p>No journal entry for this day.</p>
    <% end %>
  </div>




  <!-- Right page: photo + motivational text -->
<div class="book-page right">
  <% if journal_content&.persisted? %>
    <% if journal_content.photo.attached? %>
      <div class="photo">
        <%= image_tag url_for(journal_content.photo) %>
        <!-- Wenn Varianten bei Cloudinary funktionieren, kannst du auch:
        <%= image_tag journal_content.photo.variant(resize_to_limit: [600, 600]) %>
        -->
      </div>
    <% else %>
      <p>AI picture is being generatedâ€¦</p>
    <% end %>

    <% if journal_content.motivational_text.present? %>
      <p class="motivational"><%= journal_content.motivational_text %></p>
    <% end %>

    <%= button_to "Regenerate picture",
                  regenerate_photo_journal_content_path(journal_content),
                  method: :post,
                  class: "btn" %>

  <% elsif date == today %>
    <p>After saving today's entry, an AI-generated picture and motivational text will appear here.</p>
  <% else %>
    <p>No picture for this day.</p>
  <% end %>
</div>

</div>

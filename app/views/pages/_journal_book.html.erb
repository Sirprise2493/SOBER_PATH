<!-- app/views/pages/_journal_book.html.erb -->
<% journal_content = local_assigns.fetch(:journal_content) %>

<div class="book-container">
  <!-- Left page: input or text -->
  <div class="book-page left">
    <% if journal_content.persisted? %>
      <h2>Entry for <%= l(journal_content.created_at.to_date) %></h2>
      <p><%= simple_format(journal_content.content) %></p>
    <% else %>
      <h2>Entry for <%= l(Date.current) %></h2>

      <%= form_with model: journal_content, url: journal_contents_path do |f| %>
        <% if journal_content.errors.any? %>
          <div class="errors">
            <h3><%= pluralize(journal_content.errors.count, "error") %>:</h3>
            <ul>
              <% journal_content.errors.full_messages.each do |msg| %>
                <li><%= msg %></li>
              <% end %>
            </ul>
          </div>
        <% end %>

        <div class="field">
          <%= f.label :content, "What's on your mind today?" %><br>
          <%= f.text_area :content, rows: 15 %>
        </div>

        <div class="actions">
          <%= f.submit "Save" %>
        </div>
      <% end %>
    <% end %>
  </div>

  <!-- Right page: photo + motivational text -->
  <div class="book-page right">
    <% if journal_content.persisted? %>
      <% if journal_content.photo.attached? %>
        <div class="photo-wrapper">
          <%= image_tag journal_content.photo, alt: "Journal AI photo" %>
        </div>
      <% else %>
        <p>Image is currently being generated by the AI…</p>
      <% end %>

      <% if journal_content.motivational_text.present? %>
        <div class="motivation">
          <%= simple_format(journal_content.motivational_text) %>
        </div>
      <% else %>
        <p>Motivational text is being generated…</p>
      <% end %>

      <div class="regenerate">
        <%= button_to "Regenerate image",
                      regenerate_photo_journal_content_path(journal_content),
                      method: :post,
                      data: { turbo_confirm: "Are you sure? The existing image will be overwritten." } %>
      </div>
    <% else %>
      <p>
        After saving, an AI-generated image and a short motivational
        sentence (max. 50 characters) will appear here.
      </p>
    <% end %>
  </div>
</div>

<section class="encouragements-panel">
  <%= turbo_stream_from [current_user, :encouragements] %>

  <header class="encouragements-panel__header">
    <h2>Encouragements</h2>
    <p class="encouragements-panel__subtitle">
      Messages sent from your connections.
    </p>
  </header>

  <% if encouragements_all.any? %>
    <ul class="encouragements-panel__list connection-updates"
        id="encouragements_list">
      <%= render encouragements %>
    </ul>

    <% if total_pages > 1 %>
      <nav class="encouragements-panel__pagination encouragement-chat__pagination">
        <div class="encouragement-chat__pagination-links">
          <% if page > 1 %>
            <%= link_to "«",
                        milestones_path(enc_page: page - 1),
                        data: { turbo_frame: "encouragement_chat" },
                        class: "encouragement-chat__pagination-link encouragement-chat__pagination-link--arrow" %>
          <% else %>
            <span class="encouragement-chat__pagination-link encouragement-chat__pagination-link--arrow encouragement-chat__pagination-link--disabled">
              «
            </span>
          <% end %>

          <% visible_pages = [] %>
          <% visible_pages << 1 %>
          <% ((page - 1)..(page + 1)).each do |num| %>
            <% visible_pages << num if num > 1 && num < total_pages %>
          <% end %>
          <% visible_pages << total_pages if total_pages > 1 %>
          <% visible_pages = visible_pages.uniq.sort %>

          <% last_page = nil %>
          <% visible_pages.each do |num| %>
            <% if last_page && num > last_page + 1 %>
              <span class="encouragement-chat__pagination-link encouragement-chat__pagination-link--ellipsis">
                …
              </span>
            <% end %>

            <% if num == page %>
              <span class="encouragement-chat__pagination-link encouragement-chat__pagination-link--active">
                <%= num %>
              </span>
            <% else %>
              <%= link_to num,
                          milestones_path(enc_page: num),
                          data: { turbo_frame: "encouragement_chat" },
                          class: "encouragement-chat__pagination-link" %>
            <% end %>

            <% last_page = num %>
          <% end %>

          <% if page < total_pages %>
            <%= link_to "»",
                        milestones_path(enc_page: page + 1),
                        data: { turbo_frame: "encouragement_chat" },
                        class: "encouragement-chat__pagination-link encouragement-chat__pagination-link--arrow" %>
          <% else %>
            <span class="encouragement-chat__pagination-link encouragement-chat__pagination-link--arrow encouragement-chat__pagination-link--disabled">
              »
            </span>
          <% end %>
        </div>
      </nav>
    <% end %>
  <% else %>
    <div class="encouragements-empty-state">
      <p class="encouragements-empty-state__title">
        No encouragements yet
      </p>
      <p class="encouragements-empty-state__text">
        When friends send you encouragements from the chatroom, they’ll show up here.
      </p>
    </div>
  <% end %>
</section>

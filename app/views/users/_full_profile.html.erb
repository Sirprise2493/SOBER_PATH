<div class="profile-wrapper">
  <div class="profile-header-row">
    <div>
      <h1 class="profile-title">My Profile</h1>
    </div>

    <div class="profile-header-pill">
      <span class="profile-header-pill-label">Current streak</span>
      <span class="profile-header-pill-value"><%= @user.sobriety_days %> days</span>
    </div>
  </div>

  <!-- MAIN GRID: avatar + details -->
  <div class="profile-grid">

    <!-- LEFT CARD: avatar + name + edit button -->
    <div class="profile-card profile-card--left">

      <h2 class="profile-card-title">
        <%= @user.fullname.presence || @user.username %>
      </h2>

      <div class="profile-avatar-container">
        <% if @user.avatar.attached? %>
          <%= image_tag @user.avatar,
                        alt: @user.username,
                        class: "profile-avatar" %>
        <% else %>
          <div class="profile-avatar placeholder-avatar">
            <i>No photo</i>
          </div>
        <% end %>
      </div>

      <div class="profile-edit-wrapper">
        <%= link_to "Edit profile",
                    edit_profile_path,
                    class: "profile-edit-button" %>
      </div>

    </div>

    <!-- RIGHT CARD: bio & other details -->
    <div class="profile-card profile-card--right">

      <h2 class="profile-card-title">Bio & other details</h2>

      <div class="profile-details-grid">

        <div class="profile-field">
          <label>Username</label>
          <div class="profile-field-value"><%= @user.username %></div>
        </div>

        <div class="profile-field">
          <label>Date of Birth</label>
          <div class="profile-field-value"><%= @user.date_of_birth&.strftime("%d/%m/%Y") || "—" %></div>
        </div>

        <div class="profile-field">
          <label>Start Date</label>
          <div class="profile-field-value"><%= @user.sobriety_start_date&.strftime("%d/%m/%Y") || "—" %></div>
        </div>

        <div class="profile-field">
          <label>Current Streak</label>
          <div class="profile-field-value"><%= @user.sobriety_days %> days</div>
        </div>

        <div class="profile-field full-width">
          <label>Headline</label>
          <div class="profile-field-value">
            <%= @user.headline.presence || "—" %>
          </div>
        </div>

        <div class="profile-field full-width">
          <label>Address</label>
          <div class="profile-field-value">
            <%= @user.address.presence || "—" %>
          </div>
        </div>

        <div class="profile-field full-width">
          <label>Bio</label>
          <div class="profile-field-value">
            <%= @user.bio.present? ?
                  simple_format(truncate(@user.bio, length: 300)) :
                  "—" %>
          </div>
        </div>

      </div>

    </div>

  </div>

  <!-- FULL-WIDTH CONNECTIONS CARD UNDER PROFILE -->
  <div id="profile_connections_card">
    <%= render "users/profile_connections_card",
               friends:           @friends,
               incoming_requests: @incoming_requests,
               outgoing_requests: @outgoing_requests %>
  </div>
</div>

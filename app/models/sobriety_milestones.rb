class SobrietyMilestones
MILESTONES = [
  { file: "0.png",  name: "New Start",  offset: { days: 0 },
    description: "You’ve made a clear decision to stop drinking. Today you break the cycle and open the door to healing, hope, and a different future.",
    celebrations: [
      "Write a letter to your future sober self.",
      "Tell one trusted person about your decision.",
      "Tidy a small space to mark your new start.",
      "Take a mindful walk and say goodbye to alcohol.",
      "Create a simple routine for your first sober week."
    ]
  },

  { file: "1.png",  name: "24 hours",   offset: { days: 1 },
    description: "Your body is already starting to detox. Your heart rate and blood pressure begin to stabilize, and you’ve proven you can get through the first intense cravings.",
    celebrations: [
      "Enjoy a favorite sober drink or snack.",
      "Take a long, relaxing bath or shower.",
      "Share your 24 hours in a meeting or group.",
      "Journal about what helped you stay sober today.",
      "Go to bed early and honor your progress."
    ]
  },

  { file: "2.png",  name: "30 days",    offset: { days: 30 },
    description: "Many people notice better sleep, more stable mood, less anxiety, and more energy. Your liver is starting to repair, and your mind is clearer and more focused.",
    celebrations: [
      "Buy a small token to mark 30 days.",
      "Plan a special sober dinner with someone close.",
      "Take a social media break for self-care.",
      "Write a gratitude list for this first month.",
      "Print or save a photo of your sober month."
    ]
  },

  { file: "3.png",  name: "60 days",    offset: { days: 60 },
    description: "Your sleep and energy are becoming more consistent. Concentration, memory, and emotional stability are improving, and cravings are often less intense and less frequent.",
    celebrations: [
      "Try a new sober class, hobby, or sport.",
      "Take yourself on a solo coffee date.",
      "Start a new book that supports your growth.",
      "List 60 positive changes since you quit.",
      "Share your 60 days to encourage someone else."
    ]
  },

  { file: "4.png",  name: "90 days",    offset: { days: 90 },
    description: "Your brain chemistry is settling into a new balance. Many people feel calmer, more optimistic, and more present in relationships. Your immune system and liver function continue to improve.",
    celebrations: [
      "Take a special sober day trip somewhere you love.",
      "Invest in your body: massage, yoga, or new shoes.",
      "Write a ‘before and after’ reflection on yourself.",
      "Host a small sober game or movie night.",
      "Send thanks to someone who supported your recovery."
    ]
  },

  { file: "5.png",  name: "4 months",   offset: { months: 4 },
    description: "You’ve built a real sober routine. Sleep quality, digestion, and skin health often improve, and people around you may notice that you look healthier and more alive.",
    celebrations: [
      "Refresh or rearrange your living space.",
      "Add to a ‘sober savings’ jar or account.",
      "Join a movement or fitness-based class.",
      "Spend a full day focused on rest and joy.",
      "Write a short four-month progress summary."
    ]
  },

  { file: "6.png",  name: "5 months",   offset: { months: 5 },
    description: "Your sober habits are becoming automatic. You may feel more emotionally resilient, more productive, and more trusted by family, friends, and coworkers.",
    celebrations: [
      "Plan a meaningful one-on-one outing.",
      "Buy a small tool that eases daily life.",
      "Create a playlist that tracks your journey.",
      "Volunteer a few hours in your community.",
      "Write five promises for the next five months."
    ]
  },

  { file: "7.png",  name: "6 months",   offset: { months: 6 },
    description: "Half a year alcohol-free can mean better blood pressure, more stable weight, and improved mood. Many people feel more self-respect and a deeper sense of inner peace.",
    celebrations: [
      "Plan a weekend mini-retreat, away or at home.",
      "Get a professional photo to capture six months.",
      "Buy something for a healthy hobby or sport.",
      "Host a sober brunch or picnic with friends.",
      "Write your ‘six months sober’ story."
    ]
  },

  { file: "8.png",  name: "7 months",   offset: { months: 7 },
    description: "You are proving long-term change is possible. Your nervous system is steadier, stress is easier to handle sober, and your relationships often feel more honest and real.",
    celebrations: [
      "Take a digital detox day for rest and presence.",
      "Do something you once avoided because of drinking.",
      "Update or create a vision board for next year.",
      "Set up weekly check-ins with a friend or sponsor.",
      "Write a kind letter to someone still struggling."
    ]
  },

  { file: "9.png",  name: "8 months",   offset: { months: 8 },
    description: "Your mind is clearer and decision-making is stronger. You may notice more consistent energy throughout the day and a growing sense of confidence in your sober identity.",
    celebrations: [
      "Plan a ‘you day’ with no extra obligations.",
      "Enroll in an online course to grow a skill.",
      "Take a long walk and record voice reflections.",
      "Start a small sober activity group or meetup.",
      "Upgrade one corner of your home for calm."
    ]
  },

  { file: "10.png", name: "9 months",   offset: { months: 9 },
    description: "Your body has had many months to repair. Memory, focus, and emotional regulation tend to be much better, and many people feel more joy and motivation in daily life.",
    celebrations: [
      "Take an overnight trip to a relaxing place.",
      "Create a ‘9-month highlight’ collage or album.",
      "Buy a quality item you’ll use every day.",
      "Share in a meeting what 9 months has taught you.",
      "Write a letter to your one-year future self."
    ]
  },

  { file: "11.png", name: "10 months",  offset: { months: 10 },
    description: "You’ve stayed sober through many ups and downs. Stress coping skills are stronger, and you may feel more financially stable and more present for the people you love.",
    celebrations: [
      "Do a detailed financial check-in and reward yourself.",
      "Dedicate a day to deepening one key relationship.",
      "Book a wellness session: massage, therapy, or similar.",
      "Host a small gratitude evening with loved ones.",
      "List 10 sober rituals you want to keep."
    ]
  },

  { file: "12.png", name: "11 months",  offset: { months: 11 },
    description: "You are very close to a full year. Long-term habits are solid, your body is far healthier than when you started, and your future plans feel more realistic and hopeful.",
    celebrations: [
      "Plan your one-year celebration and guest list.",
      "Reread early journal entries and note your growth.",
      "Visit an old place with a new sober mindset.",
      "Start a project you’ll finish at one year sober.",
      "Donate time or money to a recovery cause."
    ]
  },

  { file: "13.png", name: "1 year",     offset: { years: 1 },
    description: "One year sober often means a much lower risk of many alcohol-related diseases. Your liver and heart are healthier, your thinking is clearer, and you’ve built a life that works without alcohol.",
    celebrations: [
      "Host a sober anniversary party or gathering.",
      "Take a memorable trip or weekend away.",
      "Create a time capsule with photos and letters.",
      "Get a professional portrait or family photo.",
      "Write and share your one-year sobriety story."
    ]
  },

  { file: "14.png", name: "2 years",    offset: { years: 2 },
    description: "Two years gives deep emotional and physical healing. Many people feel more stable, more authentic, and more connected. Trust in relationships is often rebuilt in a meaningful way.",
    celebrations: [
      "Take a wellness or nature-focused retreat.",
      "Start mentoring or sponsoring someone new.",
      "Invest in a big personal goal or training.",
      "Organize a sober anniversary event with your group.",
      "Write a compassionate letter to your past self."
    ]
  },

  { file: "15.png", name: "3 years",    offset: { years: 3 },
    description: "Your sober life is now your normal. Long-term health risks keep dropping, your coping skills are strong, and you may find yourself helping others who are still struggling.",
    celebrations: [
      "Plan an unforgettable sober adventure or trip.",
      "Create a recovery resource: article, video, or talk.",
      "Take a week-long vacation focused on rest and growth.",
      "Host a celebration with family and recovery friends.",
      "Review three years and set a three-year vision."
    ]
  },

  { file: "16.png", name: "5 years",    offset: { years: 5 },
    description: "Five years sober usually brings major health benefits and a greatly reduced risk of many alcohol-related conditions. Your identity, goals, and relationships are rooted in sobriety, not in drinking.",
    celebrations: [
      "Take a ‘dream trip’ you’ve saved for in sobriety.",
      "Create a yearly service project in your sobriety month.",
      "Invest in a major well-being goal or project.",
      "Organize a reunion with key people in your recovery.",
      "Write a five-year reflection for talks or writing."
    ]
  },

  { file: "17.png", name: "7 years",    offset: { years: 7 },
    description: "Your nervous system and brain have had years to heal. Many people feel emotionally mature, grounded, and free from the chaos of their drinking days.",
    celebrations: [
      "Plan a meaningful journey or pilgrimage.",
      "Support or start a local recovery initiative.",
      "Take a multi-day solo retreat for reflection.",
      "Host an anniversary event with shared stories.",
      "Begin a long-term legacy or service project."
    ]
  },

  { file: "18.png", name: "10 years",   offset: { years: 10 },
    description: "A decade of sobriety often means dramatically lower long-term health risks related to alcohol. You carry deep experience, wisdom, and stability, and your story can inspire real hope in others.",
    celebrations: [
      "Take a once-in-a-decade celebration trip.",
      "Host a large sober gathering with all communities.",
      "Start a book, blog, or podcast on recovery.",
      "Support a long-term charity around recovery or mental health.",
      "Create a yearly 10-year gratitude ritual or retreat."
    ]
  },

  { file: "19.png", name: "15 years",   offset: { years: 15 },
    description: "Fifteen years sober shows powerful, lasting change. Your life, routines, and relationships are built on clarity and honesty, not on hiding or escaping through alcohol.",
    celebrations: [
      "Plan a destination celebration with loved ones.",
      "Build or support a mentoring network in recovery.",
      "Take extended time off to travel and reflect.",
      "Host a storytelling night about long-term recovery.",
      "Outline the legacy you want your sobriety to leave."
    ]
  },

  { file: "20.png", name: "20 years",   offset: { years: 20 },
    description: "Two decades without alcohol bring long-term physical protection and emotional growth. You’ve lived a huge part of your life sober, and you are a living example that recovery is possible.",
    celebrations: [
      "Travel to a major bucket-list destination.",
      "Found or support a long-term recovery project.",
      "Organize a big anniversary event with all circles.",
      "Create a structured mentorship plan for newcomers.",
      "Write a detailed 20-year life and recovery reflection."
    ]
  },

  { file: "21.png", name: "25 years",   offset: { years: 25 },
    description: "Your body has been free from alcohol for a quarter of a century. Many people at this stage feel deep gratitude, inner peace, and a strong sense of purpose in helping others recover.",
    celebrations: [
      "Take a ‘quarter-century sober’ journey somewhere meaningful.",
      "Help establish a recovery scholarship or support fund.",
      "Host a joyful celebration honoring everyone who helped.",
      "Record or film your full recovery story.",
      "Plan a gratitude tour to important people and places."
    ]
  },

  { file: "22.png", name: "30 years",   offset: { years: 30 },
    description: "Thirty years sober usually means decades of healthier organs, clearer thinking, and more stable mental health. Your entire adult life story is shaped by recovery and growth.",
    celebrations: [
      "Take an extended dream journey or sabbatical.",
      "Create a detailed written or recorded life story.",
      "Launch or fund a long-term recovery legacy project.",
      "Gather different generations to share wisdom and stories.",
      "Create a yearly tradition to honor this milestone."
    ]
  },

  { file: "23.png", name: "35 years",   offset: { years: 35 },
    description: "With thirty-five years, sobriety is woven into every part of your life. You carry a long history of resilience, service, and emotional and spiritual growth.",
    celebrations: [
      "Travel somewhere deeply meaningful for reflection.",
      "Mentor experienced members taking on service roles.",
      "Host a gratitude and storytelling celebration.",
      "Work on preserving recovery history or stories.",
      "Write down the key wisdom you want to pass on."
    ]
  },

  { file: "24.png", name: "40 years",   offset: { years: 40 },
    description: "Forty years sober is a lifetime of healing. Your long-term health, relationships, and legacy all reflect years of choosing life, clarity, and connection over alcohol.",
    celebrations: [
      "Plan a once-in-a-lifetime experience or journey.",
      "Create a lasting legacy project for recovery.",
      "Host a large celebration honoring all touched by your sobriety.",
      "Record a full life interview for future generations.",
      "Write a legacy letter about what sobriety has meant."
    ]
  }
].freeze


  # All milestones the user has already reached
  def self.earned_for(user)
    return [] if user.sobriety_start_date.blank?

    today = Date.current

    MILESTONES.select do |milestone|
      reached_at = user.sobriety_start_date.advance(milestone[:offset])
      reached_at <= today
    end
  end

  # The latest milestone the user has reached (or nil)
  def self.current_for(user)
    earned_for(user).last
  end

  def self.reached_at(user, milestone)
    return nil if user.sobriety_start_date.blank?

    # nuse Time-Zone
    zone = user.time_zone.presence || Time.zone.name
    base_time = user.sobriety_start_date.to_time.in_time_zone(zone)
    base_time.advance(milestone[:offset])
  end

  # next Milestone
  def self.next_for(user)
    return nil if user.sobriety_start_date.blank?

    now = Time.zone.now
    MILESTONES
      .map { |m| [m, reached_at(user, m)] }
      .select { |_m, time| time.present? && time > now }
      .min_by { |_m, time| time }
  end
end
